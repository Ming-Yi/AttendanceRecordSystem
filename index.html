<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>NCHU 出勤記錄系統 - Login</title>
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/login.css" rel="stylesheet">

<script type="text/javascript">
	$(function() {
    $("body").on("input propertychange", ".floating-label-form-group", function(e) {
        $(this).toggleClass("floating-label-form-group-with-value", !! $(e.target).val());
    }).on("focus", ".floating-label-form-group", function() {
        $(this).addClass("floating-label-form-group-with-focus");
    }).on("blur", ".floating-label-form-group", function() {
        $(this).removeClass("floating-label-form-group-with-focus");
    });
});
</script>
<script type="text/javascript">
	$(function(){
		$("#submit").click(postlogin);

		$("#user,#pwd").keyup(function(event){
		    if(event.keyCode == 13){
		        postlogin();
		    }
		});
	})
	function postlogin(){
			var user = $("#user").val();
			var pwd = $("#pwd").val();

			if(user=="" || pwd=="" ){
				alert("請輸入帳號密碼");
				return false;
			}
			var userdata = "{\"user\":\""+user+"\",\"pwd\":\""+pwd+"\"}";
			$.ajax({
				url: 'php/nchu.php',
				type: 'POST',
				dataType: 'json',
				data: {"action":"Login","data": userdata},
			})
			.done(function(data) {
				if(data['state']!="failed"){
					//data['schnos']
					//data['jsession']
					var d = new Date();
					d.setTime(d.getTime() + ( 15 * 60 * 1000));
					var expires = "expires=" + d.toGMTString();
					document.cookie = "jsession="+ data['jsession'] + ";" + expires + "; path=/";
					document.cookie = "schnos="+ data['schnos'] + ";" + expires + "; path=/";
					document.cookie = "account="+ user + ";" + expires + "; path=/";
					document.location.href="attendance.html";
				}
				else{
					alert("登入失敗");
				}
			})
			.fail(function() {
				console.log("error");
			})
			.always(function() {
				console.log("complete");
			});
		}
</script>
</head>
<body>
    <div class = "show">
        <div class="container">
        	<H1 class="text-center">出勤記錄系統</H1>
            <div class="row">
                <div class="col-lg-12">
                    <img class="img-responsive" src="img/computer.png" alt="">
                    <div class="intro-text">     
                        <div class="row">
							<div class="form-group fileinput">
		                        <div class="row control-group">
		                            <div class="form-group col-xs-12 floating-label-form-group controls">
		                                <label for="user">帳號</label>
		                                <input type="text" class="form-control" placeholder="帳號" name="user" id="user">
		                            </div>
		                        </div>
		                       	<div class="row control-group">
		                            <div class="form-group col-xs-12 floating-label-form-group controls">
		                                <label for="pwd">密碼</label>
		                                <input type="password" class="form-control" placeholder="密碼" name="pwd" id="pwd">
		                            </div>
		                        </div>
								<div class="form-group text-center">
									<button id="submit" class="btn btn-successmyself btn-lg">Login</button>
								</div>
                        	</div>
                    	</div>
                	</div>
            	</div>
        	</div>
    	</div>
    </div>
</body>
</html>